<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category   design_default
 * @package    Mage
 * @copyright  Copyright (c) 2008 Irubin Consulting Inc. DBA Varien (http://www.varien.com)
 * @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>

<?php
$_categoryobj = Mage::getModel('catalog/category');
$_category  = $this->getCurrentCategory();
//print "<pre>"; print_r($_category);
if($_category->level>1) {
	$maincategory = $_category->path_ids[1];
} else if($_category->level<1) {
	if($_defultcategory = $_categoryobj->loadByAttribute('name','tennis')) {
		$maincategory = $_defultcategory->entity_id;
	}
} else {
	$maincategory = $_category->entity_id;
}
$collection = $_categoryobj->getCategories($maincategory);
$helper     = Mage::helper('catalog/category');
?>

<div id="main-nav">
<ul>
<?php foreach ($collection as $category): ?>
<?php 	$last = false; 
		$level = 0; $html = '';
        if (!$category->getIsActive()) {
            return $html;
        }
        if (Mage::helper('catalog/category_flat')->isEnabled()) {
            $children = $category->getChildrenNodes();
            $childrenCount = count($children);
        } else {
            $children = $category->getChildren();
            $childrenCount = $children->count();
        }
        $hasChildren = $children && $childrenCount;
        $html.= '<li';
        $html.= ' class="level'.$level;
        $html.= ' nav-' . $this->_getItemPosition($level);
        if ($this->isCategoryActive($category)) {
            $html.= ' active';
        }
        if ($last) {
            $html .= ' last';
        }
        if ($hasChildren) {
            $cnt = 0;
            foreach ($children as $child) {
                if ($child->getIsActive()) {
                    $cnt++;
                }
            }
            if ($cnt > 0) {
                $html .= ' parent';
            }
        }
        $html.= '">'."\n";
        //$html.= '<a href="'.$this->getCategoryUrl($category).'"';
		$html.= '<a';
		if (!$hasChildren) {
			$html.= ' class="no-submenu"';
		}
		$html.= '><span>'.$this->htmlEscape($category->getName()).'</span></a>'."\n";

        if ($hasChildren){

            $j = 0;
            $htmlChildren = '';
            foreach ($children as $child) {
                if ($child->getIsActive()) {
                    //$htmlChildren.= $this->drawItem($child, $level+1, ++$j >= $cnt);
					$htmlChildren.= '<li class="level1"><a href="'.$this->getCategoryUrl($child).'" class="';
					$htmlChildren.= ' rounded {transparent}"><span>'.$child->getName().'</span></a></li>';
                }
            }

            if (!empty($htmlChildren)) {
                $html.= '<ul class="level' . $level . '">'."\n"
                        .$htmlChildren
                        .'</ul>';
            }

        }
     	$html.= '</li>'."\n";
		echo $html;	?>
  <?php endforeach ?>
</ul>
</div>
